# # Ubuntu 22.04 ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì‚¬ìš©
# FROM ubuntu:22.04

# # ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì‘ì—…í•  ë””ë ‰í† ë¦¬ ì§€ì •
# WORKDIR /app

# # í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° Node.js 18 ì„¤ì¹˜
# RUN apt-get update && apt-get install -y curl gnupg \
#     && curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
#     && apt-get install -y nodejs \
#     && apt-get clean

# # yarn ì„¤ì¹˜ (ì„ íƒì‚¬í•­: npm ëŒ€ì‹  yarn ì‚¬ìš© ì‹œ)
# RUN npm install -g yarn

# # ì˜ì¡´ì„± ì„¤ì¹˜ìš© íŒŒì¼ ë³µì‚¬
# COPY package.json yarn.lock ./

# # ì˜ì¡´ì„± ì„¤ì¹˜
# RUN yarn install

# # ì†ŒìŠ¤ ì½”ë“œ ì „ì²´ ë³µì‚¬
# COPY . .

# # Next.js ë¹Œë“œ
# RUN yarn build

# # ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ ì˜¤í”ˆ
# EXPOSE 3000

# # ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œ ì‹¤í–‰í•  ëª…ë ¹ì–´
# CMD ["yarn", "start"]


# Ubuntu 22.04 ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì‚¬ìš©
FROM ubuntu:22.04

# ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì‘ì—…í•  ë””ë ‰í† ë¦¬ ì§€ì •
WORKDIR /app

# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° Node.js 18 ì„¤ì¹˜
RUN apt-get update && apt-get install -y curl gnupg \
    && curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs \
    && apt-get clean

# yarn ì„¤ì¹˜ (ì„ íƒì‚¬í•­: npm ëŒ€ì‹  yarn ì‚¬ìš© ì‹œ)
RUN npm install -g yarn

# ğŸ”½ í™˜ê²½ë³€ìˆ˜ ì£¼ì… (Azureì—ì„œ ì „ë‹¬ë°›ì€ ìê²©ì¦ëª… ì¸ì‹ìš©)
ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
ENV AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
ENV AWS_REGION=ap-northeast-2

# ì˜ì¡´ì„± ì„¤ì¹˜ìš© íŒŒì¼ ë³µì‚¬
COPY package.json yarn.lock ./

# ì˜ì¡´ì„± ì„¤ì¹˜
RUN yarn install

# ì†ŒìŠ¤ ì½”ë“œ ì „ì²´ ë³µì‚¬
COPY . .

# Next.js ë¹Œë“œ
RUN yarn build

# ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ ì˜¤í”ˆ
EXPOSE 3000

# Express ì„œë²„ë¡œ ì•± ì‹¤í–‰
CMD ["node", "server.mjs"]
